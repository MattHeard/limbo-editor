#!/usr/bin/env ruby

class Subcommand
  DESCRIPTIONS = {
    'new' => 'creates a new project'
  }.freeze

  def initialize(name)
    @name = name
  end

  def description
    descriptions[name]
  end

  def name
    @name
  end

  private

  def descriptions
    DESCRIPTIONS
  end
end

def subcommand_descriptions
  subcommand_descriptions = {
    'new' => Subcommand.new('new').description,
    'list-tests' => 'lists test descriptions'
  }
  subcommand_descriptions.default = 'Limbo EDitor'
  subcommand_descriptions
end

def subcommand
  ARGV.first
end

def not_list_tests?
  subcommand != 'list-tests'
end

def help?
  ARGV[1] == '--help'
end

def describe_subcommand
  puts subcommand_descriptions[subcommand]
end

def test_dir
  './tmp/spec'
end

def test_contents
  %x{cat #{test_dir}/*}
end

def feature_descriptions
  test_contents.split("\n")
end

def matches
  feature_descriptions.map { |d| d.match(/describe '(.*)'/) }
end

def features
  matches.map { |m| m[1] }
end

def list_features
  puts features.join("\n")
end

def describe_subcommand?
  not_list_tests? || help?
end

if describe_subcommand?
  describe_subcommand
else
  list_features
end
